## ì‹œìŠ¤í…œ ì½œ(System Call)
### ğŸŒŸ ì•Œê³  ê°€ê¸°! ğŸŒŸ
**ì»¤ë„ ëª¨ë“œë€?**
> í”„ë¡œì„¸ì„œì˜ íŠ¹ê¶Œ ë ˆë²¨ë¡œ í”„ë¡œì„¸ì„œì˜ ëª¨ë“  ëª…ë ¹ì„ ì²˜ë¦¬í•˜ë©° ì‹œìŠ¤í…œì˜ ìì›ì´ë‚˜ í•˜ë“œì›¨ì–´ë¥¼ ì§ì ‘ì ìœ¼ë¡œ ì—‘ì„¸ìŠ¤í•˜ì—¬ ì»¨íŠ¸ë¡¤í•  ìˆ˜ ìˆëŠ” ëª¨ë“œ. 
> ì‹¤ì œ ì¥ì¹˜ ë“œë¼ì´ë²„ë‚˜ ìš´ì˜ì²´ì œ í”„ë¡œê·¸ë¨ì´ êµ¬ë™í•˜ëŠ” ëª¨ë“œ

**ì‚¬ìš©ì ëª¨ë“œë€?**
> ì¼ë°˜ ì‘ìš© í”„ë¡œê·¸ë¨ì´ ë™ì‘í•˜ëŠ” ë¹„íŠ¹ê¶Œ ëª¨ë“œ.
> ì‹œìŠ¤í…œì˜ ìì›ì´ë‚˜ í•˜ë“œì›¨ì–´ë¥¼ ì§ì ‘ì ìœ¼ë¡œ ì»¨íŠ¸ë¡¤ í•  ìˆ˜ ì—†ìœ¼ë©° ì´ë¥¼ í•˜ê¸° ìœ„í•´ì„œëŠ” **ì‹œìŠ¤í…œ ì½œ**ì„ ì‚¬ìš©í•´ì•¼ í•œë‹¤.

##

### 1. ì‹œìŠ¤í…œ ì½œ(System Call) ì´ë€? ğŸŒŸ
**ì •ì˜**
> ì»¤ë„ ì˜ì—­ì˜ ê¸°ëŠ¥ì„ ì‚¬ìš©ì ëª¨ë“œê°€ ì‚¬ìš© ê°€ëŠ¥í•˜ë„ë¡! 
> â‡’ ì¦‰, í”„ë¡œì„¸ìŠ¤ê°€ í•˜ë“œì›¨ì–´ì— ì§ì ‘ ì ‘ê·¼í•´ì„œ í•„ìš”í•œ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” ê²ƒ. 

![img](https://t1.daumcdn.net/cfile/tistory/23791D3B55CC38683A)

##

### 2. ì‹œìŠ¤í…œ ì½œ(System Call)ê³¼ ì¸í„°ëŸ½íŠ¸(Interrupt)
* ì‹œìŠ¤í…œ ì½œì€ ì†Œí”„íŠ¸ì›¨ì–´ê°€ ë°œìƒì‹œí‚¤ëŠ” [**ë™ê¸°ì  ì¸í„°ëŸ½íŠ¸ì¸ trap**](https://github.com/haewon-park/csStudy/blob/main/OS/%EC%9D%B8%ED%84%B0%EB%9F%BD%ED%8A%B8%20.md)ì˜ í•œ ì¢…ë¥˜ë¡œ ë³¼ ìˆ˜ ìˆë‹¤. 

##
### 3. ì‹œìŠ¤í…œ ì½œ(System Call)ì˜ ìœ í˜•
1. í”„ë¡œì„¸ìŠ¤ ì œì–´: í”„ë¡œì„¸ìŠ¤ íŠ¹ê¶Œ ëª¨ë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ì§ì ‘ì ìœ¼ë¡œ í”„ë¡œì„¸ìŠ¤ ì œì–´ê°€ ê°€ëŠ¥
2. íŒŒì¼ ì¡°ì‘ : íŒŒì¼ì„ ìƒì„±í•˜ê±°ë‚˜ ì‚­ì œ, ê´€ë¦¬ ë“±
3. ì¥ì¹˜ ê´€ë¦¬ : ì¥ì¹˜ ìš”êµ¬ ë° ì¥ì¹˜ í•´ì œ, ì½ê¸°, ì“°ê¸°, ì¬ë°°ì¹˜ ë“±
4. ì •ë³´ ìœ ì§€: ì‹œê°„ê³¼ ë‚ ì§œì˜ ì„¤ì •ê³¼ íšë“, ì‹œìŠ¤í…œ ìë£Œì˜ ì„¤ì •ê³¼ íšë“
5. í†µì‹  : í†µì‹  ì—°ê²°ì˜ ìƒì„± ë° ì œê±°, ë©”ì‹œì§€ì˜ ì†¡ìˆ˜ì‹ , ìƒíƒœ ì •ë³´ ì „ë‹¬ ë“±

##
### 4. ëŒ€í‘œì ì¸ ì‹œìŠ¤í…œ ì½œ(System Call)
**1) Fork()**
> ìƒˆë¡œìš´ í”„ë¡œì„¸ìŠ¤ë¥¼ ìƒì„±í•  ë•Œ ì‚¬ìš©. 
```c
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>

int main(int argc, char *argv[]) {
    printf("pid : %d", (int) getpid()); // pid : 29146
    
    int rc = fork();					// ì£¼ëª©
    
    if (rc < 0) {
        exit(1);
    }									// (1) fork ì‹¤íŒ¨
    else if (rc == 0) {					// (2) child ì¸ ê²½ìš° (fork ê°’ì´ 0)
        printf("child (pid : %d)", (int) getpid());
    }
    else {								// (3) parent case
        printf("parent of %d (pid : %d)", rc, (int)getpid());
    }
}
```
[output]
```
pid : 29146
parent of 29147
child (pid : 29147)
```

* fork()ê°€ ì‹¤í–‰ë˜ëŠ” ìˆœê°„. í”„ë¡œì„¸ìŠ¤ê°€ í•˜ë‚˜ ë” ìƒê¸°ëŠ”ë°, ì´ ë•Œ ìƒê¸´ ìì‹(child) í”„ë¡œì„¸ìŠ¤ëŠ” forkë¥¼ ë§Œë“  ë¶€ëª¨(parent) í”„ë¡œì„¸ìŠ¤ì™€ (ê±°ì˜) ë™ì¼í•œ ë³µì‚¬ë³¸ì„ ê°–ê²Œ ë¨.
* **ì´ ë•Œ, ìš´ì˜ì²´ì œëŠ” ìœ„ì™€ ë˜‘ê°™ì€ 2ê°œì˜ í”„ë¡œê·¸ë¨ì´ ë™ì‘í•œë‹¤ê³  ìƒê°í•˜ê³ , fork()ê°€ returnë  ì°¨ë¡€ë¼ê³  ìƒê°í•œë‹¤. â‡’  ë”°ë¼ì„œ, ìì‹(child) í”„ë¡œì„¸ìŠ¤ëŠ” mainì´ ì•„ë‹Œ ifë¬¸ë¶€í„° ì‹œì‘í•˜ê²Œ ë˜ëŠ” ê²ƒ.**
* ìì‹(child) ë¶€ëª¨(parent) í”„ë¡œì„¸ìŠ¤ì˜ fork() ê°’ì´ ë‹¤ë¥´ë‹¤ëŠ” ì  â‡’ ë”°ë¼ì„œ, ì™„ì „í•œ ë™ì¼í•œ ë³µì‚¬ë³¸ì´ë¼ê³  í•  ìˆ˜ ì—†ìŒ.
* **ë‘˜ ì¤‘ ëˆ„ê°€ ë¨¼ì € ì‹¤í–‰ë ì§€ëŠ” ì•Œ ìˆ˜ ì—†ìŒ. ìŠ¤ì¼€ì¤„ëŸ¬ê°€ ê²°ì •í•˜ëŠ” ê²ƒ**

```
Parentì˜ fork()ê°’ â‡’ childì˜ pid ê°’

Childì˜ fork()ê°’ â‡’ 0
```
<br>

**2) wait()**
> ìì‹(child) í”„ë¡œì„¸ìŠ¤ê°€ ì¢…ë£Œë  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¬ëŠ” ì‘ì—…
ìœ„ì˜ ì˜ˆì‹œì— int wc = wait(NULL)ë§Œ ì¶”ê°€í•¨.

```C
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <sys/wait.h>

int main(int argc, char *argv[]) {
    printf("pid : %d", (int) getpid()); // pid : 29146
    
    int rc = fork();					// ì£¼ëª©
    
    if (rc < 0) {
        exit(1);
    }									// (1) fork ì‹¤íŒ¨
    else if (rc == 0) {					// (2) child ì¸ ê²½ìš° (fork ê°’ì´ 0)
        printf("child (pid : %d)", (int) getpid());
    }
    else {								// (3) parent case
        int wc = wait(NULL)				// ì¶”ê°€ëœ ë¶€ë¶„
        printf("parent of %d (wc : %d / pid : %d)", wc, rc, (int)getpid());
    }
}
```
```
pid : 29146

child (pid : 29147)

parent of 29147 (wc : 29147 / pid : 29146)
```
* waitë¥¼ í†µí•´ì„œ ìì‹(child)ì˜ ì‹¤í–‰ì´ ëë‚  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¼.
* ë¶€ëª¨(parent)ê°€ ë¨¼ì € ì‹¤í–‰ë˜ë”ë¼ë„, wait()ëŠ” ìì‹(child)ê°€ ëë‚˜ê¸° ì „ì—ëŠ” return í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ, ë°˜ë“œì‹œ ìì‹(child)ê°€ ë¨¼ì € ì‹¤í–‰ë¨.
<br>

**3) exec()**
>  ë‹¨ìˆœ fork()ëŠ” ë™ì¼í•œ í”„ë¡œì„¸ìŠ¤ì˜ ë‚´ìš©ì„ ì—¬ëŸ¬ë²ˆ ë™ì‘í•  ë•Œ ì‚¬ìš©.
>  ìì‹(child)ì—ì„œëŠ” ë¶€ëª¨(parent)ì™€ ë‹¤ë¥¸ ë™ì‘ì„ í•˜ê³  ì‹¶ì„ ë•ŒëŠ” execë¥¼ ì‚¬ìš©!
```c
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <sys/wait.h>

int main(int argc, char *argv[]) {
    printf("pid : %d", (int) getpid()); // pid : 29146
    
    int rc = fork();					// ì£¼ëª©
    
    if (rc < 0) {
        exit(1);
    }									// (1) fork ì‹¤íŒ¨
    else if (rc == 0) {					// (2) child ì¸ ê²½ìš° (fork ê°’ì´ 0)
        printf("child (pid : %d)", (int) getpid());
        char *myargs[3];
        myargs[0] = strdup("wc");		// ë‚´ê°€ ì‹¤í–‰í•  íŒŒì¼ ì´ë¦„
        myargs[1] = strdup("p3.c");		// ì‹¤í–‰í•  íŒŒì¼ì— ë„˜ê²¨ì¤„ argument
        myargs[2] = NULL;				// end of array
        execvp(myarges[0], myargs);		// wc íŒŒì¼ ì‹¤í–‰.
        printf("this shouldn't print out") // ì‹¤í–‰ë˜ì§€ ì•ŠìŒ.
    }
    else {								// (3) parent case
        int wc = wait(NULL)				// ì¶”ê°€ëœ ë¶€ë¶„
        printf("parent of %d (wc : %d / pid : %d)", wc, rc, (int)getpid());
    }
}
```
* exec()ê°€ ì‹¤í–‰ë˜ë©´ execvp( ì‹¤í–‰ íŒŒì¼, ì „ë‹¬ ì¸ì ) í•¨ìˆ˜ëŠ” code segment ì˜ì—­ì— ì‹¤í–‰ íŒŒì¼ì˜ ì½”ë“œë¥¼ ì½ì–´ì™€ì„œ ë®ì–´ ì”Œì›€.
* ì´í›„, heap, stack, ë‹¤ë¥¸ ë©”ëª¨ë¦¬ ì˜ì—­ì´ ì´ˆê¸°í™”ë˜ê³ , OSëŠ” ê·¸ëƒ¥ ì‹¤í–‰
â‡’ **ì¦‰, ìƒˆë¡œìš´ í”„ë¡œì„¸ìŠ¤ë¥¼ ìƒì„±í•˜ì§€ ì•Šê³ , í˜„ì¬ í”„ë¡œê·¸ë¨ì— wcë¼ëŠ” íŒŒì¼ì„ ì‹¤í–‰**
â‡’ execvp() ì´í›„ì˜ ë¶€ë¶„ì€ ì‹¤í–‰X

---

**ì°¸ê³  ìë£Œ**
* https://gyoogle.dev/blog/computer-science/operating-system/System%20Call.html
* https://velog.io/@woo00oo/%EC%8B%9C%EC%8A%A4%ED%85%9C-%EC%BD%9CSystem-Call
