## 세마포어(Semaphore) & 뮤텍스(Mutex)
### 알고 가기! 
**병행 프로세스(Concurrent Process)**
> 두 개 이상의 포르세스들이 동시에 존재하며 실행 상태에 있는 것

**임계구역(Critical Section)** 🌟
> 여러 프로세스가 데이터를 공유하며 수행될 때, 각 프로세스에서 공유 데이터를 접근하는 프로그램 코드 부분

**상호 배제(Mutual Exclusion)**
> 공유 자원을 어느 시점에서 단지 한 개의 프로세스만이 사용할 수 있도록 하며, 다른 프로세스가 공유자원에 대하여 접근하지 못하게 제어하고 각 프로세스가 번갈아 가며 공유 자원을 사용하도록 하는 것으로 **임계 구역을 유지하는 기법**

**동기화 기법(Synchronization)**
> 두 개 이상의 프로세스를 한 시점에서는 동시에 처리할 수 없으므로 **각 프로세스에 대한 처리 순서를 결정**하는 것으로 상호 배제의 한 형태

##

### 1. 세마포어(Semaphore) 란? 🌟
**🌟 정의**
> 멀티 프로그래밍 환경에서 공유 자원에 대한 접근을 제한하는 방법
> 리소스의 상태를 나타내는 간단한 카운터라고 보면 됨!  ⇒ 체제 또는 커널의 한 지정된 저장장치 내의 값

`예) 화장실이 여러 개 있고, 화장실 입구에는 빈 화장실 개수를 알려주는 전광판이 있는 것고 비슷!
모든 칸의 화장실이 사용 중일 때의 전광판 숫자는 0, 손님들은 전광판 숫자가 1로 바뀔 때까지 대기.
용무를 마친 손님이 화장실에서 나오면 전광판 숫자 +1, 대기하던 손님은 전광판 숫자 -1을 하며 화장실을 이용.`

![img](https://t1.daumcdn.net/cfile/tistory/99F46C3359E0A53A09)
<br>


**세마포어 P, V 연산**
- P: 임계 구역에 들어가기 전에 수행(프로세스 진입 여부 자원의 개수(S)를 통해 결정)
- V: 임계 구역에서 나올 때 수행(자원 반납 알림, 대기 중인 프로세스를 깨우는 신호)
<br>


*구현 방법*
```c
procedure P(S)   --> 최초 S값은 1임
    while S=0 do wait  --> S가 0면 1이 될때까지 기다려야 함
    S := S-1   --> S를 0로 만들어 다른 프로세스가 들어 오지 못하도록 함
end P

--- 임계 구역 ---

procedure V(S) --> 현재상태는 S가 0임
    S := S+1   --> S를 1로 원위치시켜 해제하는 과정
end V
```
한 프로세스가 P 또는 V를 수행하고 있는 동안 프로세스가 인터럽트를 당하지 않게 됨 ⇒ **P와 V를 이용하여 임계 구역에 대한 상호배제 구현이 가능**

##

### 2. 뮤텍스(Mutex)? 🌟
**정의**
> 임계구역(Critical Section)을 가진 스레드들의 실행 시간이 서로 겹치지 않고, 각각 단독으로 실행되게 하는 기술
> 다중 프로레스들이 공유 자원에 대한 접근을 조율하기 위해 lock과 unlock을 사용 ⇒ 상태가 0, 1 두개 뿐인 *이진 세마포어*

`예) 화장실(공유자원)이 하나 밖에 없는 식당과 비슷. 화장실을 가기 위해서 카운터에서 키(뮤텍스)를 받아 가야함. 
카운터에 키가 있다면 화장실 이용 가능 / 카운터에 키가 없다면 누군가 사용하는 것임으로 카운터에 키를 반납할 때까지 대기`

![img](https://blog.kakaocdn.net/dn/zhK18/btqt0az0Ula/LYv41yy8D5AqFK3ZSEc5vK/img.png)

* lock : 현재 임계 구역에 들어갈 권한을 얻어옴 ( 만약 다른 프로세스/스레드가 임계 구역 수행 중이면 종료할 때까지 대기 )
* unlock : 현재 임계 구역을 모두 사용했음을 알림. ( 대기 중인 다른 프로세스/스레드가 임계 구역에 진입할 수 있음 )

<br>

*구현 방법*
```c
mutex = 1;

void lock () {
	while (mutex != 1) 
  {
    // mutex 값이 1이 될 때까지 대기
  }
    // 이 구역에 도착했다는 것은 화장실 키를 획득 했다는 것이고 mutex 값이 1이라는 뜻. 이제 뮤텍스 값을 0으로 만들어 다른 프로세스(혹은 쓰레드)의 접근을 제한.
   mutex = 0;
}

void unlock() {
	// 임계 구역(화장실)에서 나온 프로세스는 다른 프로세스가 접근할 개수 있도록 뮤텍스 값을 1으로 만들어 락을 해제.
	mutex = 1;
}
```

##

### 3. 세마포어(Semaphore) & 뮤텍스(Mutex)의 차이 🌟
* **큰 차이는 동기화 대상의 개수 🌟**
	* 세마포어: 동기화 대상이 한 개 이상일 때
	* 뮤텍스: 동기화 대상이 한 개 일 때
* 세마포어는 파일시스템 상 파일의 형래로 존재, 뮤텍스는 프로세스 범위
	* 즉, 프로세스가 사라질 때 뮤텍스는 사라짐.
	* 세마포어는 소유할 수 없는 반면, 뮤텍스는 소유할 수 있음
* 해제
	* 세마포어: 세마포어를 소유하고 있지 않은 쓰레드도 이 세마포어 해제 가능
	* 뮤텍스를 소유하고 있는 쓰레드만 이 뮤텍스 해제 가능

---

**참고 자료**
* https://github.com/gyoogle/tech-interview-for-developer/blob/master/Computer%20Science/Operating%20System/Semaphore%20%26%20Mutex.md
* https://jokerkwu.tistory.com/126
